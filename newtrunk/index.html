<html lang="en" style="font-size: 100px;"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <link href="css/database.css" rel="stylesheet">
    <link rel="stylesheet" href="css/swiper.min.css">
    <link href="css/my.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <script src="js/swiper.min.js"></script>
    <title>游戏列表</title>
    <script>
        (function (doc, win) {
            // 分辨率Resolution适配
            var docEl = doc.documentElement,
                    resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                    recalc = function () {
                        var clientWidth = docEl.clientWidth;
                        if (!clientWidth) return;
                        if (clientWidth >= 750 && clientWidth <= 1000 ) {
                            docEl.style.fontSize = 100 + 'px';
                        } else if(clientWidth >= 1000){
                            docEl.style.fontSize = 100 * (1000 / 720) + 'px';
                        }else{docEl.style.fontSize = 100 * (clientWidth / 720) + 'px';}
                    }
            // Abort if browser does not support addEventListener
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            recalc();
        })(document, window);
    </script>
</head>
<body>
<div class="swiper-container swiper-container-horizontal">
    <div class="swiper-wrapper"
         style="transform: translate3d(-2250px, 0px, 0px); -webkit-transform: translate3d(-2250px, 0px, 0px); transition-duration: 0ms; -webkit-transition-duration: 0ms;">
        <div class="swiper-slide swiper-slide-duplicate">
            <a href="">
                <img src="http://dahua.eastday.com/songheng/sharefolder/img/questionnaire/2/1464850850_123027_e1d00d1e3f081e0aded42ec607816816.jpeg">
            </a></div>
        <div class="swiper-slide">
            <a href="">
                <img src="http://dahua.eastday.com/songheng/sharefolder/img/questionnaire/1/1474176975_879704_8170d47d42f2ed2ef152db494ace7ad7.jpeg">
            </a></div>
        <div class="swiper-slide swiper-slide-prev">
            <a href="">
                <img src="http://dahua.eastday.com/songheng/sharefolder/img/questionnaire/1/1473146350_681522_ee55559d5c7809576dc8b9536ed53294.png">
            </a></div>
        <div class="swiper-slide swiper-slide-active">
            <a href="">
                <img src="http://dahua.eastday.com/songheng/sharefolder/img/questionnaire/1/1473130322_462867_e6c54e87120ce24c061de6df63252556.jpeg">
            </a></div>
        <div class="swiper-slide swiper-slide-next">
            <a href="">
                <img src="http://dahua.eastday.com/songheng/sharefolder/img/questionnaire/1/1471427402_849932_4beb156c779c4665f3b40e23f2762315.jpeg">
            </a></div>
    </div>
    <div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets"><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span><span class="swiper-pagination-bullet"></span><span class="swiper-pagination-bullet"></span></div>
</div>

<div class="system" id="J_test_list">
    <ul></ul>
</div>

<!--loading框开始-->
<div id="J_loading" class="loading" style="display: none;">
    <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
    <p class="txt">数据加载中</p>
</div>
<div id="J_load_more" class="loading" style="display:none;">
    <p class="txt">没有更多数据了...</p>
</div>
<!--loading框结束-->
<div id="J_footer" class="footer">
    <p>沪ICP备13005144号-3</p>
</div>
<script>
    var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        paginationClickable: true,
        loop:true,
        spaceBetween: 30,
        autoplay:5000
    });
    var $coverAd=$('.system_her');
    $coverAd.click(function () {
        $.ajax({
            type: "GET",
            url:"http://gxjifen.dftoutiao.com/Index/adv_clicknum/s_id/0",
            dataType: "jsonp",
            jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)
            jsonpCallback:"flightHandler_adv_clicknum",//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写"?"，jQuery会自动为你处理数据
            success: function(json){},
            error: function(){
                alert("fail,请刷新页面重新测试");
            }
        });
    });
    //第四条插入广告
    /* var iframe=$('<iframe>');
     //var width=$('window').width();
     iframe.width('100%');
     iframe.attr({src:'/public/gg_baidu.html?ggid=u2693933'});
     iframe.attr({scrolling:'no'});*/
    $('.system ul li').eq(3).after($('<li style="height:auto;padding:0.2rem 0.3rem;"><iframe src="/public/gg_baidu.html?ggid=u2693933" width="100%" height="120" frameborder="0" scrolling="no"></iframe></li>'));
    $('.system ul li').eq(9).after('<li style="height:auto;padding:0.2rem 0.3rem;"><iframe src="/public/gg_baidu.html?ggid=u2693933" width="100%" height="120" frameborder="0" scrolling="no"></iframe></li>');
    $('.system ul li').eq(14).after('<li style="height:auto;padding:0.2rem 0.3rem;"><iframe src="/public/gg_baidu.html?ggid=u2693933" width="100%" height="120" frameborder="0" scrolling="no"></iframe></li>');
    //判断设备为手机端还是PC
    /*function browserRedirect() {
     var sUserAgent = navigator.userAgent.toLowerCase();
     var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
     var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
     var bIsMidp = sUserAgent.match(/midp/i) == "midp";
     var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
     var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
     var bIsAndroid = sUserAgent.match(/android/i) == "android";
     var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
     var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
     //手机端
     if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {

     } else {
     $('.system_fots ').addClass('mobile-system-fots');
     $('.erweima').show();
     }
     //PC端
     }
     browserRedirect();*/
    /*多少人测试过初始化的十条*/
    testPeople(0,10);
    /**
     * 记录测试的次数  循环10次  n为循环起始  m为循环末尾
     * @return {[type]}     [description]
     */
    function testPeople(n,m){
        $JceguoNum=$('.J-ceguo-num');
        var $testList=$('#J_test_list');
        var dataIdArr=[];
        for(var i=n;i<m;i++){
            dataIdArr.push($testList.find('.item').eq(i).attr('data-id'));
        }
        dataIdArr.toString();
        $.ajax({
            type: "GET",
            url:"http://gxjifen.dftoutiao.com/Index/start_ceshinum/s_id/"+dataIdArr,
            dataType: "jsonp",
            jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)
            jsonpCallback:"flightHandler_start_ceshinum",//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写"?"，jQuery会自动为你处理数据
            success: function(json){
                var b=0;
                for(var i=n;i<m;i++){
                    if(!json[b]){
                        $JceguoNum.eq(i).text(1);
                    }else{
                        $JceguoNum.eq(i).text(json[b]);
                    }
                    b++;
                }
            },
            error: function(){
                alert("fail,请刷新页面重新测试");
            }
        });
    }


    /**
     * 上拉加载数据
     * @return {[type]}     [description]
     */
    var $loading = $('#J_loading'),
            n=1,
            scrollTimer;

    function pullUpLoadData(){
        $.ajax({
            type: "GET",
            url:"http://gxjifen.dftoutiao.com/Index/survey_data/num/"+n,
            dataType: "jsonp",
            jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)
            jsonpCallback:"flightHandler_survey_data",//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写"?"，jQuery会自动为你处理数据
            beforeSend: function(){
                $loading.show();
            },
            success: function(data){
                n++;
                if(data.status==0){
                    $loading.hide();
                    $('#J_load_more').show();
                    return false;
                }else{
                    generateDom(data);
                    testPeople((10*n-10),10*n);
                }

            },
            error: function(){
                console.log('fail');
            },
            complete: function(){
                $loading.hide();
            }
        });
    }
    function generateDom(data){
        $.each(data,function (i, n) {
            if(i==6){
                if(n.status==1){
//                    var script=document.createElement("script");
//                    script.src="http://cpro.baidustatic.com/cpro/ui/cm.js";
//                    script.type="text/javascript";
                    $('.system ul').append('<li class="item clearfix"  data-id="'+n.id+'"><a href="'+n.file_path+'"><div class="system_img"><img src="'+n.min_images+'" class="system_img-img"></div><div class="system_fots "><div class="system_wenzi">'+n.title+'</div><div class="system_hot"><div class="system_hot-img">热</div><div class="system_hot-fonts"><span><i class="J-ceguo-num"></i>测过</span></div></div></div><div class="erweima"><img src="'+n.code_images+'" alt=""></div></a></li><li style="height:auto;padding:0.2rem 0.3rem;"><iframe src="/public/gg_baidu.html?ggid=u2693933" width="100%" height="120" frameborder="0" scrolling="no"></iframe></li>');
                }else{
//                    var script=document.createElement("script");
//                    script.src="http://cpro.baidustatic.com/cpro/ui/cm.js";
//                    script.type="text/javascript";
                    $('.system ul').append('<li class="item clearfix items"  data-id="'+n.id+'"><a href="'+n.file_path+'" class="system_her"><h3>'+n.title+' </h3><div class="system_img"><img src="'+n.min_images+'" class="system_img-img"></div> <div class="system_img"><img src="'+n.min_images1+'" class="system_img-img"></div><div class="system_img"><img src="'+n.min_images2+'" class="system_img-img"></div> <div class="system_fots "> <div class="system_hot"><div class="system_hot-img">热</div><div class="system_hot-fonts"><span><i class="J-ceguo-num"></i>测过</span></div></div></div></a></li><li style="height:auto;padding:0.2rem 0.3rem;"><iframe src="/public/gg_baidu.html?ggid=u2693933" width="100%" height="120" frameborder="0" scrolling="no"></iframe></li>');
                }
            }else{
                if(n.status==1){
                    $('.system ul').append('<li class="item clearfix"  data-id="'+n.id+'"><a href="'+n.file_path+'"><div class="system_img"><img src="'+n.min_images+'" class="system_img-img"></div><div class="system_fots "><div class="system_wenzi">'+n.title+'</div><div class="system_hot"><div class="system_hot-img">热</div><div class="system_hot-fonts"><span><i class="J-ceguo-num"></i>测过</span></div></div></div><div class="erweima"><img src="'+n.code_images+'" alt=""></div></a></li>');
                }else{
                    $('.system ul').append('<li class="item clearfix items"  data-id="'+n.id+'"><a href="'+n.file_path+'" class="system_her"><h3>'+n.title+' </h3><div class="system_img"><img src="'+n.min_images+'" class="system_img-img"></div> <div class="system_img"><img src="'+n.min_images1+'" class="system_img-img"></div><div class="system_img"><img src="'+n.min_images2+'" class="system_img-img"></div> <div class="system_fots "> <div class="system_hot"><div class="system_hot-img">热</div><div class="system_hot-fonts"><span><i class="J-ceguo-num"></i>测过</span></div></div></div></a> </li>');
                }
            }
        });
        /*browserRedirect();*/
    }

    $(window).on('scroll', function() {
        var  scrollTop = getScrollTop(),
                footerOT = $('#J_footer').offset().top,
                cHeight = getClientHeight();
        if(scrollTop + cHeight >= footerOT){
            // 上拉加载数据(延迟执行，防止操作过快多次加载)
            clearTimeout(scrollTimer);
            scrollTimer = setTimeout(function(){
                pullUpLoadData();
            }, 200);
        }
    });
    /**
     * 获取滚动高度
     * @return {[type]} [description]
     */
    function getScrollTop(){
        if (document.documentElement && document.documentElement.scrollTop) {
            return document.documentElement.scrollTop;
        } else if (document.body) {
            return document.body.scrollTop;
        }
    }
    /**
     * 获取文档高度
     * @return {[type]} [description]
     */
    function getClientHeight(){
        if (document.body.clientHeight && document.documentElement.clientHeight) {
            return (document.body.clientHeight < document.documentElement.clientHeight) ? document.body.clientHeight: document.documentElement.clientHeight;
        } else {
            return (document.body.clientHeight > document.documentElement.clientHeight) ? document.body.clientHeight: document.documentElement.clientHeight;
        }
    }
</script>

</body></html>